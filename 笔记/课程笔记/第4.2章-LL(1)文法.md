---
date: 2025-11-15
---
[[第4.1章-自顶向下分析#预测分析|预测分析法]]的工作过程：
从文法开始符号出发，在每一步推导过程中根据当前句型的最左非终结符A和当前输入符号a，选择正确的A-产生式。为保证分析的确定性，选出的候选式必须是**唯一**的。

$S\_$ 文法（最简单的确定性文法）：
- 每个产生式的右部都以**终结符开始**
- 同一非终结符的各个候选式的**右部首符号互不相同**

这样就确保了在分析过程中，根据当前输入符号a，可以唯一确定要选择的A-产生式。

可以看出 $S\_$ 文法**不包括空产生式**，这限制了它的应用范围。为了解决这个问题，引入了后继符号集的概念。

## 非终结符的后继符号集-Follow集

非终结符A的后继符号集 $Follow(A)$ 定义为：在某个句型的某个位置上出现**A后面紧跟的终结符**集合。

如果A是句型的最后一个符号，则将**句型结束符号** $\$$ 也包含在 $Follow(A)$ 中。

例子：
![[Pasted image 20251116142027.png]]
该文法中B后紧跟C，而C可以推导出c, a，因此 $Follow(B) = \{c, a\}$。

## 产生式的可选集-Select集


> [!note] [[第2.1章-CFG上下文无关语法#符号约定|符号约定]]
> 注意这里可能搞混的符号：
> - 小写字母$a$表示一个终结符
> - 希腊字母 $\alpha$ 表示串

产生式 $A \rightarrow \alpha$ 的可选集 $Select(A \rightarrow \alpha)$ 定义为：可以选用该产生式进行推导的**输入符号集合**。

- $Select(A \rightarrow a \beta) = \{a\}$
- $Select(A\to \epsilon)=Follow(A)$

理解起来比较绕，反过来会更好理解，对于一个输入符号：
- 输入符号$a$可以选用产生式 $A\to a \beta$
- $A$的后继符号集元素可选用空产生式

如果一个非终结符的各个产生式的**可选集两两互不相交**，我们就可以做出**确定的分析**。

$q\_$ 文法：
- 每个产生式右部或为空，或以终结符开始
- 同一非终结符的各个产生式的可选集两两互不相交

可以看出 $q\_$ 文法不允许产生式右部以非终结符开始，这限制了它的应用范围。为了解决这个问题，可以引入串首非终结符集和 [[第4.1章-自顶向下分析#预测分析|LL (1) 文法]]的概念。

## 串首终结符集-First集

串首终结符：串首第一个符号，且是一个终结符。

串首终结符集 $First(\alpha)$ 定义为：能够从符号串 $\alpha$ 推导出的所有**串首终结符集合**。如果 $\alpha \implies^*\epsilon, 那么\epsilon也在First(\alpha)中$。

由此可以重新定义可选集：
- 若 $\alpha$ 不可推导出 $\epsilon$，则 $Select(A \rightarrow \alpha) = First(\alpha)$
- 若 $\alpha$ 可推导出 $\epsilon$，则 $Select(A \rightarrow \alpha) = (First(\alpha) - \{\epsilon\}) \cup Follow(A)$

---

讲了半天，其实含义还是很简单：
- 如果产生式右部不能推导出空串，那么可选集就是右部的串首终结符集（就是要一一匹配）
- 如果产生式右部能推导出空串，那么可选集就是右部的串首终结符集（去掉空串）加上非终结符的后继符号集（能导出空串说明存在 $A\implies*\epsilon$，回顾后继符号集的概念，当然就能选用紧跟在当前非终结符后的符号）

所谓可选集，就是可以选用当前产生式的输入符号集合。

## LL (1) 文法

文法G是LL (1) 文法的充要条件：
对于每个非终结符A的任意两个不同产生式 $A \rightarrow \alpha | \beta$，都有：
- 若 $\alpha, \beta$ 均不能导出空串，则 $First(\alpha) \cap First(\beta) = \emptyset$
- 若 $\alpha$ 能导出空串，则 $First(\beta) \cap Follow(A) = \emptyset$
- 若 $\beta$ 能导出空串，则 $First(\alpha) \cap Follow(A) = \emptyset$
- $\alpha,\beta$ **至多**有一个能导出空串

这样就保证了对于每个非终结符A的各个产生式，其**Select集两两互不相交**，从而可以构造出确定的预测分析器。

“LL(1)”的含义：
- 第一个L：从左到右扫描输入串
- 第二个L：最左推导
- 1：向前看1个符号

---
对【若 $\alpha$ 能导出空串，则 $First(\beta) \cap Follow(A) = \emptyset$ 】的理解：
回顾串首终结符集的内容，若 $\alpha$ 可推导出 $\epsilon$，则 $Select(A \rightarrow \alpha) = (First(\alpha) - \{\epsilon\}) \cup Follow(A)$，即此时 $Select (A \rightarrow \alpha)$ 包含了 $Follow(A)$ 中的元素，为了保证可选集不交叉，就要求 $First(\beta)$ 中不能包含 $Follow(A)$ 中的元素。

对【向前看1个符号】的理解：
检查输入流中的下一个终结符（或结束符 $），然后根据 First/Follow 的规则在可选的产生式中做出选择。若某个产生式右部 α 能推导出 ε，那么在构造预测（Select）集合时会把 Follow(A) 并入，这相当于用紧跟在非终结符 A 之后可能出现的符号来决定是否选用那个 ε 产生式，从而在效果上像是“跳过”了 A 去匹配后面的符号。

举个简单例子：S → A b，A → ε | a。First(A) = {a, ε}，Follow(A) 包含 b。当下一个输入符号是 b 时，预测表会把 A → ε 的 Select 包含 b，因此解析器在看到 b 时会选择 A → ε（相当于跳过 A 去匹配 b）；当下一个输入是 a 时，会选择 A → a 并消费 a。这个例子说明了用 Follow 处理可空右部的实际用途，但整个决定过程仍然只依赖一个向前看的符号。

### 文法符号X的First集计算

观察所有产生式，根据定义，先将产生式右侧的串首终结符加入First集，然后处理非终结符，将其First集加入当前符号的First集，若能导出空串，则继续处理下一个符号，直到遇到终结符或串尾。

例子：
![[Pasted image 20251116191456.png]]
首先将【+,(】这两个终结符加入对应的First集中，再将包含空产生式的First集中加入 $\epsilon$。然后依次判断其余产生式，右部第一个符号是非终结符时，将其First集加入当前符号的First集中，直到不能再加入为止。

### 文法符号X的Follow集计算

计算出First集后，开始计算Follow集。

1. 将开始符号的Follow集中加入结束符号 $\$$（这是因为开始符号是一切之本，“开始符号”整体后就结束了）
2. 对于每个产生式 $A \rightarrow \alpha B \beta$，将 $First(\beta) - \{\epsilon\}$ 加入 $Follow(B)$（最显然的一条，因为 $\beta$ 就是B的后继符号）
3. 对于每个产生式 $A \rightarrow \alpha B$ 或 $A \rightarrow \alpha B \beta$，若 $\beta$ 能导出空串，则将 $Follow(A)$ 加入 $Follow(B)$（这表明能跟在A后的输入也能跟在B后）
4. 重复步骤2和3，直到所有Follow集不再变化为止

![[Pasted image 20251116193945.png]]
如图中例子，先将结束符号加入 $Follow(E)$ 中（==规则1==），然后根据产生式依次计算各个非终结符的Follow集。先看产生式右部，例如 $E\to TE'$，根据右部可以将 $Follow (T)$ 加入 $First (E')$ 中的**非空**符号（==规则2==），再看 $E'$ 能否导出空串，能的话就将 $Follow (E)$ 也加入 $Follow (T)$ 中（==规则3==）。

![[Pasted image 20251116194039.png]]
循环操作，直到不再变化为止。

### 文法各产生式的Select集计算

计算出所有非终结符的First集和Follow集后，就可以根据Select集的定义计算各产生式的Select集了.

不同于 $q\_$ 文法中的规则，现在构造出的产生式右部可以以非终结符开始。因此需要对Select集的定义进行补充：
对于 $A\to B\beta$ ：
- 若 $B$ 能导出空串，则 $Select(A\to B\beta) = (First(B) - \{\epsilon\}) \cup First(\beta)$
- 若 $B$ 不能导出空串，则 $Select(A\to B\beta) = First(B)$

其余两条规则为：
- $Select(A \rightarrow a \beta) = \{a\}$
- $Select(A\to \epsilon)=Follow(A)$

例子：
![[Pasted image 20251116195204.png]]

### LL (1) 预测分析表的构造

预测分析表 $M[A, a]$ 的行对应非终结符A，列对应终结符a（包括结束符号 $\$$）。根据产生式的Select集填入表格，可以方便地查找当前输入符号、当前非终结符所对应的产生式。

![[Pasted image 20251116195732.png]]
因为Select集互不相交，所以每个表格位置最多填入一个产生式，这保证了分析的确定性。