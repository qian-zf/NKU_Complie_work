---
date: 2025-11-15
---
自顶向下分析：从顶部的根节点向叶节点进行分析构造分析树

可以看成是从文法开始符号 $S$ 推导出词串的过程

每一步推导中都需要做两个选择：
1. 选择当前分析树中尚未展开的**非终结符节点**
2. 选择一个**产生式**来展开该非终结符节点

## 最左推导

最左推导：每次选择当前分析树中最左侧的尚未展开的非终结符节点进行展开

例子：
![[Pasted image 20251115190512.png]]
图中红色标识表示最左推导过程中每一步选择的非终结符节点

如果反过来自底向上，就是最右规约。两者互为逆过程。
## 最右推导

最右推导：每次选择当前分析树中最右侧的尚未展开的非终结符节点进行展开

最左推导和最右推导具有唯一性。

对于自顶向下分析而言，最左推导更为重要，因为它与 LL (1) 分析法密切相关。

## 自顶向下分析的通用形式

自顶向下分析的通用形式可以用**递归下降分析**来实现：
- 由一组**过程**组成，每个**非终结符**对应一个过程

可以用伪代码表示：
```
void A() {
	选择一个产生式 A -> X1, X2, ......Xk;
	for ( i = 1 to k ) 
		if (Xi 是非终结符) 调用过程Xi();
		else if (Xi 等于当前输入符号) 读入下一个输入符号;
		else 报错;
}
```

从文法开始符号 S 对应的过程开始执行，如果 S 对应的过程成功结束且**输入符号全部读入**，则分析成功，否则失败。

然而，递归下降分析存在**回溯**的问题：
- 在选择产生式时，如果选择错误，可能需要回溯到之前的状态重新选择
- 回溯会导致效率低下，甚至无法终止
- 需要回溯的分析器称为不确定的分析器

### 预测分析

预测分析是递归下降分析的一种特殊形式，通过在输入中**向前看固定数量**（通常是1个）的符号来选择产生式，从而避免回溯。

可以对某些文法构造出向前看 $k$ 个符号即可进行预测分析的分析器，称为 LL (k) 分析器，该文法称为 LL (k) 文法。

预测分析不需要回溯，是一种确定的分析方法。

## 文法转换

有些文法可能无法直接用于自顶向下分析，存在某些问题：
- 同一个非终结符的多个候选式有共同前缀，这将导致回溯（如 $S\to aBC|aDE$）
- 若右部以非终结符开头，可能导致左递归（如 $S\to S a|b$）
	- 含有 $A\to A\alpha$ 形式产生式的文法称为**直接左递归**文法
	- 如果一个文法中有一个非终结符 $A$，存在 $A\implies^+ A\alpha$ 的推导，称该文法是**左递归的文法**
	- 经过两步或两步以上的推导产生的左递归，称为**间接左递归**

回顾 $\implies^+$：[[第2.1章-CFG上下文无关语法#推导|推导正数次]]

产生左递归的原因：最左推导过程中会**无限展开左侧的非终结符**，导致无法终止。例如：$S\to S a|b$ 匹配输入 $a$ 的过程中，会无限展开 $S$，无法匹配到终结符。

### 消除左公因子

通过改写产生式推迟决定，等读入足够多的输入后再做选择。

例如：
$$S\to aBC|aDE$$
可以转换为：
$$
S\to aS', S'\to BC|DE
$$

### 消除直接左递归

对于直接左递归的产生式：
$$
A\to A \alpha | \beta(\alpha\neq \epsilon, \beta不以A开头)
$$
可以看作正则表达式：
$$
r=\beta \alpha^*
$$
可以转换为不含左递归的形式：
$$A\to \beta A'$$
$$A'\to \alpha A'|\epsilon$$
这样就避免了左递归，使用 $A'$ 负责处理 $\alpha$ 的重复。

事实上这种消除的过程就是把左递归替换为右递归。可以套用上述公式进行转换，例如：
![[Pasted image 20251115195023.png]]

简单的理解：将左递归的部分提取出来，放到一个新的非终结符中，并用 $\epsilon$ 来表示不再继续递归的情况。

### 消除间接左递归

间接左递归的例子：
$$
S \to Aa|b, A\to AC|Sd|\epsilon
$$
产生间接左递归的原因：
$$
S\implies Aa\implies Sda
$$
可以通过**代入**的方式来消除间接左递归，即将 $S$ 的产生式代入到 $A$ 的产生式中，得到：
$$
A\to AC | Aad | bd | \epsilon
$$
然后再对 $A$ 进行直接左递归的消除，得到最终结果：
$$
A\to bdA'|A', A'\to cA' | adA' | \epsilon
$$
